{% extends 'base.html' %}
{% load static %}
{% load i18n %}
{% load stars_rating %}
{% load crispy_forms_tags %}


{% block header_stuff %}
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker.min.css">
{% endblock %}


{% block content %}
    <div class="booking-proposal-container">
        <a href="#booking_area" class="btn btn-primary btn-booking-proposal">
            {% trans 'Click here to book a guide!' %}
        </a>
    </div>

    <div class="guide-action-container">
        <div class="main-buttons">
            <a class="btn btn-primary" href="{% url 'chat_creation_guide' guide.uuid %}">{% blocktrans %}Send Message{% endblocktrans %}</a>
            <a href="#booking_area" class="btn btn-primary btn-booking-proposal">{%  trans 'Book' %}</a>
        </div>
        <div class="scroll-top-container">
            <a href="#profile_container" class="btn btn-primary" id="scroll_top">
                <i class="fa fa-chevron-up" aria-hidden="true"></i>
            </a>
        </div>
    </div>

    <div class="container">
        <div class="breadcrumb-guide-container text-center">
            <ul class="breadcrumb">
                <li><a href="{% url 'home' %}">{% blocktrans %}Home{% endblocktrans %}</a>
                </li>
                <li><a href="{% url 'guides' %}?city_input={{ guide.city.original_name }}">{{ guide.city.original_name }}</a>
                <li class="active">{{ guide.user.generalprofile.first_name }}</li>
            </ul>
        </div>

        <div class="row">
            <div class="col-lg-6 col-lg-offset-3">
                <div class="profile-container" id="profile_container">
                    <div class="images">
                        <div class="fotorama" data-allowfullscreen="true" data-nav="thumbs" data-width="100%">
                            <img src="{% get_media_prefix %}{{ guide.profile_image }}"
                                     alt="Image for {{ guide_answer.guide.user.generalprofile.first_name }}"
                                     class="img-responsive"
                                     title="Image for {{ guide_answer.guide.user.generalprofile.first_name }}" />
                            {% for guide_answer in guide_answers %}
                                <img src="{% get_media_prefix %}{{ guide_answer.image }}"
                                     alt="Image for {{ guide_answer.guide.user.generalprofile.first_name }}"
                                     class="img-responsive"
                                     title="Image for {{ guide_answer.guide.user.generalprofile.first_name }}" />
                            {% endfor %}
                        </div>
                    </div>
                    <div class="location">
                        {{ guide.city.full_location }}
                    </div>
                    <div class="general-info" id="guide_general_info">
                        <span class="name">{{ guide.user.generalprofile.first_name }}</span>, <span>{{ guide.user.generalprofile.age }}</span><br>
                        <span class="profession">{{ guide.user.generalprofile.profession|default_if_none:"" }}</span>
                    </div>

                    <div class="answers">
                        {% if guide.user.userinterest_set.all %}
                            <div class="answer-container">
                                <p class="question">{% trans 'ASK' %} <b>{{ guide.user.generalprofile.first_name }}</b> {% trans 'ABOUT' %}</p>
                                <p class="answer">
                                    {% for item in guide.user.userinterest_set.all %}
                                        <span class="label label-default label-tag">
                                            {{ item.interest.name }}
                                        </span>
                                    {% endfor %}
                                </p>
                            </div>
                        {% endif %}

                        {% for guide_answer in guide_answers %}
                            <div class="answer-container">
                                <p class="question">
                                    <b>{{ guide_answer.question.text|safe }}</b>
                                </p>
                                <p class="answer">{{ guide_answer.text|safe }}</p>
                                {% if guide_answer.image %}
                                    <div class="answer-image">
                                        <img src="{{ guide_answer.image.url }}" class="img-responsive">
                                    </div>
                                {% endif %}
                            </div>
                        {% endfor %}
                    </div>

                    <div class="social-networks text-center">
                        {% if guide.user.generalprofile.twitter %}
                            <a href="https://twitter.com/intent/user?user_id={{ guide.user.generalprofile.twitter }}"
                               target="_blank"
                               class="btn btn-social-icon btn-twitter btn-lg"><span class="fa fa-twitter"></span></a>
                        {% endif %}
                        {% if guide.user.generalprofile.facebook %}
                            <a href="https://facebook.com/{{ guide.user.generalprofile.facebook }}"
                                target="_blank"
                                class="btn btn-social-icon btn-facebook btn-lg"><span class="fa fa-facebook"></span></a>
                        {% endif %}
                        {% if guide.user.generalprofile.instagram %}
                            <a href="https://instagram.com/{{ guide.user.generalprofile.instagram }}"
                                target="_blank"
                                class="btn btn-social-icon btn-instagram btn-lg"><span class="fa fa-instagram"></span></a>
                        {% endif %}
                    </div>

                    <div class="actions-panel">

                        <div class="text-center mb10">
                            {% if guide != request.user.guideprofile %}
{#                                {% if current_order.status.id == 5 %}#}
{#                                    <a class="btn btn-primary btn-lg popup-text btn-order-review" href="#writing_feedback_modal"#}
{#                                    data-effect="mfp-zoom-out" data-order_id="{{ current_order.id }}">#}
{#                                        {% blocktrans %}Write Review{% endblocktrans %}#}
{#                                    </a>#}
{#                                {% endif %}#}
                                <h4 class="text-center">{% trans 'Do you have any questions?' %}</h4>
                                <a class="btn btn-primary btn-lg"
                                   href="{% url 'chat_creation_guide' guide.uuid %}">{% trans 'Chat With Guide' %}</a>
                            {% endif %}
                        </div>
                    </div>


                    <div class="booking-item-dates-change" id="booking_area">
                        <h3 class="text-center">{% trans 'Booking area' %}</h3>
                        {% crispy form %}
                    </div>
                </div>
            </div>
        </div>
    </div>

{% endblock %}

{% block js_stuff %}
    <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/js/bootstrap-datetimepicker.min.js"></script>

    <script>
        $(document).ready(function(){
            if ($("#id_date") !== undefined){
                $("#id_date").datetimepicker({
                     minDate: new Date(),
                     format: 'MM/DD/YYYY HH:mm'
                });
            };

            function finalPriceCalculation(){
                if ($("#price_total")){
                    price = {{ guide.rate }};
                    nmb_people = $("#id_hours").val();
                    final_price = price*nmb_people;
                    $("#price_total").text(final_price);
                }
            }
            finalPriceCalculation();
            $("#id_hours").on("change", function(){
                finalPriceCalculation();
            });

        })
    </script>
{% endblock js_stuff %}