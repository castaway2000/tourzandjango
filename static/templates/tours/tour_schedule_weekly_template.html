{% extends 'tours/profile_settings_guide_tour_edit.html' %}
{% load static %}
{% load i18n %}
{% load crispy_forms_tags %}

{% block header_stuff %}
    {{ block.super }}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/css/select2.min.css">
{% endblock %}

{% block tour_edit_content %}
    <div class="row">
        <div class="col-lg-12">
            <div>
                <a class="btn btn-primary" href="{% url 'tour_edit_price_and_schedule' slug %}">
                    {% trans 'Back to nearest tours list' %}
                </a>
            </div>
            <form method="post" class="mt20">{% csrf_token %}
                <div class="row">
                    <div class="form-group col-lg-12">
                        <h4>
                            {% trans 'Quick day template' %}
                        </h4>

                        {% trans 'Apply it to all days.' %}<br>
                        {% trans 'Afterwards you can edit every weekday below.' %}
                    </div>
                </div>
                <div class="row">
                    <div class="form-group col-lg-2">
                        <label>{% trans 'time start' %}</label>
                        <input class="form-control timeinput" name="time_start" value="{{ form.time_start.value }}">
                    </div>
                    <div class="form-group col-lg-2">
                        <label>{% trans 'price' %}</label>
                        <input class="form-control" name="price" type="number" min="0" value="{{ form.price.value }}">
                    </div>
                    <div class="form-group col-lg-2">
                        <label>{% trans 'seats limit' %}</label>
                        <input class="form-control" name="seats_total" type="number" min="0" value="{{ form.seats_total.value }}">
                    </div>
                    <div class="form-group col-lg-2">
                        <input type="submit" class="btn btn-primary btn-inlineform"
                               name="quick-template" value="{% trans 'Save' %}">
                    </div>
                </div>
            </form>
            {% if weekly_template_items %}
                <form method="post">{% csrf_token %}
                    <div class="row">
                        <div class="form-group col-lg-12 mt20">
                            <h4>{% trans 'Weekly schedule by weekdays.' %}</h4>
                        </div>
                    </div>
                    {% regroup weekly_template_items by day as template_items_list %}
                    {% for item in template_items_list %}
                        <div class="">
                            <b>{{ item.grouper }}</b>
                        </div>
                        {% for schedule_item in item.list %}
                            <div class="row">
                                <div class="form-group col-lg-2">
                                    <label>{% trans 'time start' %}</label>
                                    <input class="form-control timeinput" name="time_start-{{ forloop.counter }}"
                                        value="{{ schedule_item.time_start|date:"H:i" }}">
                                </div>
                                <div class="form-group col-lg-2">
                                    <label>{% trans 'price' %}</label>
                                    <input class="form-control" name="price-{{ forloop.counter }}" type="number"
                                           min="0" value="{{ schedule_item.price }}">
                                </div>
                                <div class="form-group col-lg-2">
                                    <label>{% trans 'seats limit' %}</label>
                                    <input class="form-control" name="seats_total-{{ forloop.counter }}" type="number"
                                           min="0" value="{{ schedule_item.seats_total }}">
                                </div>
                                <div class="form-group col-lg-2">
                                    <button class="btn btn-success btn-inlineform">+</button>
                                </div>
                            </div>
                        {% endfor %}
                    {% endfor %}
                    <div class="row">
                        <div class="form-group col-lg-6 text-center">
                            <button type="submit" class="btn btn-primary">{% trans 'Save' %}</button>
                        </div>
                    </div>
                </form>
            {% endif %}
        </div>
    </div>
{% endblock tour_edit_content %}

{% block js_stuff %}
    {{ block.super }}
    <script>
        $(document).ready(function() {

            $(".timeinput").timepicker({
                minuteStep: 10,
                showMeridian: false,
                disableFocus: true
            });
        })
    </script>
{% endblock %}