{% extends 'base_profile.html' %}
{% load static %}

{% block content_profile %}
    <div class="col-md-9">
        <form action="" method="post" enctype="multipart/form-data">{% csrf_token %}
            <div class="row">

                <div class="col-md-8">
                    <h4>Tour Editing page</h4>

                    <span id="tour_id" class="hidden">{{ tour.id }}</span>

                    <div class="form-group form-group-icon-left"><i class="fa fa-lock input-icon"></i>
                        <label>Name:</label>
                        <span>{{ form.name.errors }}</span>
                        <input class="form-control" name="{{ form.name.html_name }}"
                            {% if form.name.value %}
                               value="{{ form.name.value }}"
                            {% endif %}
                        >
                    </div>

                    <div class="form-group form-group-icon-left"><i class="fa fa-envelope input-icon"></i>
                        <label>Overview</label>
                        <textarea rows="7" maxlength="50000"
                                  placeholder="Add here tour overview"
                                  name="{{ form.overview.html_name }}" class="form-control" >{% if form.overview.value %}{{ form.overview.value }}{% endif %}</textarea>
                    </div>

                    <div class="checkbox">
                        <label>
                          <input type="checkbox" name="{{ form.is_active.html_name }}"
                              {% if form.is_active.value %}checked{% endif %}
                          > Is active
                        </label>
                    </div>

                </div>

                <div class="col-md-4">
                    <h4>Pricing</h4>

                    <div class="form-group">
                        <label>Payment type: </label>
                        <select class="form-control" id="payment_type" name="{{ form.payment_type.html_name }}">
                            {% for payment_type in payment_types %}
                                <option value="{{ payment_type.id }}"
                                        {% if payment_type.id == tour.payment_type.id %}selected{% endif %}>
                                    {{ payment_type.name }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div id="hourly_area" class="hidden">
                        <div class="form-group">
                            <label>Currency: </label>
                            <select class="form-control" id="currency" name="currency">
                                {% for currency in currencies %}
                                    <option value="{{ currency.id }}">{{ currency.name }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="form-group form-group-icon-left"><i class="fa fa-lock input-icon"></i>
                            <label>Price Hourly:</label>
                            <input type="number" step="0.01" class="form-control"
                                   name="price_hourly" value="{{ tour.price_hourly|safe }}">
                        </div>

                        <div class="form-group form-group-icon-left"><i class="fa fa-lock input-icon"></i>
                            <label>Minimum Hours duration:</label>
                            <input type="number" class="form-control"
                                   name="min_hours" value="{{ tour.min_hours }}">
                        </div>

                    </div>

                    <div id="fixed_area" class="hidden">

                        <div class="form-group">
                            <label>Currency: </label>
                            <select class="form-control" id="currency" name="currency">
                                {% for currency in currencies %}
                                    <option value="{{ currency.id }}">{{ currency.name }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="form-group form-group-icon-left"><i class="fa fa-lock input-icon"></i>
                            <label>Price:</label>
                            <input type="number" step="0.01" class="form-control"
                                   name="price" value="{{ tour.price|safe }}">
                        </div>

                        <div class="form-group form-group-icon-left"><i class="fa fa-lock input-icon"></i>
                            <label>Hours duration:</label>
                            <input type="number" class="form-control"
                                   name="hours" value="{{ tour.hours }}">
                        </div>

                    </div>

                </div>

                <div class="col-lg-12">
                    <div class="form-group">
                        <label>Add Image</label>
                        <input type="file" name="new_images" multiple>
                    </div>
                </div>


                <div class="col-lg-7">
                    {% if tour %}
                        <div class="form-group">
                            <button class="btn btn-danger" id="buttom_delete_image" data-action="{% url 'deactivate_tour_image' %}">Delete Image</button>
                            <div class="fotorama" data-allowfullscreen="true" data-nav="thumbs" data-width="100%">
                                {% for tour_image in tours_images %}
                                    <img src="{% get_media_prefix %}{{ tour_image.image }}" alt="Image for {{ tour.name }}"
                                         class="img-responsive"
                                         title="Image for {{ tour.name }}">
                                {% endfor %}
                            </div>
                        </div>
                    {% endif %}
                </div>

                <div class="col-lg-12">
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>

            </div>
        </form>
    </div>
{% endblock %}


{% block js_stuff %}
    <script>
        $(document).ready(function(){
            $(document).on("click", "#buttom_delete_image", function(e){
                e.preventDefault();
                var fotoramaDiv = $('.fotorama').fotorama();
                var data = fotoramaDiv.data('fotorama').activeFrame;
                var img_link = data.img;
                fotoramaDiv.data('fotorama').splice(0, 1);

                var tour_id = $('#tour_id').text();
                var url = $(this).data("action")

                data = {};
                var csrf_token = $('#csrf_getting_form [name="csrfmiddlewaretoken"]').val();
                data["csrfmiddlewaretoken"] = csrf_token;
                data["img_link"] = img_link;
                data["tour_id"] = tour_id;

                $.ajax({
                    url: url,
                    type: 'POST',
                    data: data,
                    cache: true,

                    success: function (data) {
                        console.log("1");
                    },
                    error: function(){
                        console.log("2");
                    }
                })

            });
        });
    </script>
{% endblock %}
